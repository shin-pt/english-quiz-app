
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ëã±‰ºöË©±„ÇØ„Ç§„Ç∫ - ÊóÖË°å„Éï„É¨„Éº„Ç∫„Éû„Çπ„Çø„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: #666;
            font-size: 1em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.95em;
            cursor: pointer;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
            touch-action: manipulation;
        }

        .mode-btn:hover, .mode-btn:active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .quiz-progress {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: #e0e0e0;
        }

        .quiz-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quiz-counter {
            font-size: 1em;
            color: #666;
        }

        .quiz-score {
            font-size: 1em;
            color: #667eea;
            font-weight: bold;
        }

        .quiz-content {
            text-align: center;
            padding: 10px 0;
        }

        .question-text {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.4;
            font-weight: 600;
            word-break: keep-all;
        }

        .answer-options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .answer-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            touch-action: manipulation;
            width: 100%;
        }

        .answer-btn:hover, .answer-btn:active {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(3px);
        }

        .answer-btn.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            animation: correctPulse 0.6s ease;
        }

        .answer-btn.incorrect {
            background: #ffebee;
            border-color: #f44336;
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .voice-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
            white-space: nowrap;
        }

        .voice-btn:hover, .voice-btn:active {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .voice-btn.listening {
            background: #f44336;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }

        .input-container {
            margin-bottom: 20px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .submit-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: #4caf50;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .submit-btn:hover, .submit-btn:active {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
            font-size: 1em;
            animation: slideIn 0.5s ease;
            line-height: 1.6;
        }

        .feedback strong {
            font-size: 1.1em;
        }

        .feedback.correct strong {
            color: #1976d2;
        }

        .feedback.incorrect strong {
            color: #d32f2f;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-container {
            background: rgba(255, 255, 255, 0.98);
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .results-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3em;
            color: #4caf50;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .results-message {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .results-details {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .restart-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .restart-btn:hover, .restart-btn:active {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .start-screen {
            text-align: center;
            padding: 20px;
        }

        .start-screen h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 15px;
        }

        .start-screen p {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .start-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            background: #4caf50;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .start-btn:hover, .start-btn:active {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }

        .hint-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: #ff9800;
            color: white;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            touch-action: manipulation;
        }

        .hint-btn:hover, .hint-btn:active {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .hint-text {
            color: #ff9800;
            font-style: italic;
            margin-top: 15px;
            font-size: 1em;
        }

        .permission-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: left;
            font-size: 0.9em;
        }

        .permission-info h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .permission-info ol {
            margin-left: 20px;
            color: #856404;
        }

        .permission-info li {
            margin-bottom: 5px;
        }

        /* „Çπ„Éû„ÉõÂ∞ÇÁî®„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 1.5em;
                gap: 5px;
            }

            .header p {
                font-size: 0.9em;
                margin-bottom: 10px;
            }

            .mode-selector {
                gap: 8px;
            }

            .mode-btn {
                padding: 10px 15px;
                font-size: 0.85em;
                border-radius: 20px;
            }

            .quiz-container {
                padding: 15px;
                border-radius: 10px;
                min-height: 350px;
            }

            .quiz-header {
                margin-bottom: 15px;
                font-size: 0.9em;
            }

            .question-text {
                font-size: 1.3em;
                margin-bottom: 20px;
            }

            .answer-btn {
                padding: 12px;
                font-size: 1em;
                border-radius: 10px;
            }

            .voice-controls {
                gap: 8px;
                margin-bottom: 15px;
            }

            .voice-btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .start-screen h2 {
                font-size: 1.5em;
            }

            .start-btn {
                padding: 12px 30px;
                font-size: 1.1em;
            }

            .results-title {
                font-size: 1.6em;
            }

            .results-score {
                font-size: 2.5em;
            }

            /* „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÁî®„ÅÆË™øÊï¥ */
            .answer-btn:active {
                transform: scale(0.98);
            }

            .voice-btn:active {
                transform: scale(0.95);
            }

            /* Â∞è„Åï„ÅÑÁîªÈù¢„Åß„ÅÆÊñáÂ≠óÊäò„ÇäËøî„ÅóÂØæÁ≠ñ */
            .mode-btn {
                flex: 0 0 calc(50% - 4px);
                justify-content: center;
            }

            /* „Éí„É≥„ÉàË°®Á§∫„ÅÆË™øÊï¥ */
            .hint-text {
                font-size: 0.9em;
            }

            /* ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆË™øÊï¥ */
            .text-input {
                font-size: 16px; /* iOS„ÅÆ„Ç∫„Éº„É†Èò≤Ê≠¢ */
                padding: 12px;
            }
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÂêë„Åë„ÅÆË™øÊï¥ */
        @media (min-width: 481px) and (max-width: 768px) {
            .header h1 {
                font-size: 2.2em;
            }

            .mode-btn {
                padding: 12px 25px;
                font-size: 1em;
            }

            .question-text {
                font-size: 1.8em;
            }

            .quiz-container {
                padding: 30px;
            }
        }

        /* Ê®™Âêë„ÅçÂØæÂøú */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 10px 20px;
                margin-bottom: 10px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .quiz-container {
                min-height: 300px;
                padding: 15px;
            }

            .question-text {
                font-size: 1.2em;
                margin-bottom: 15px;
            }

            .answer-btn {
                padding: 10px;
            }
        }

        /* „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Âêë‰∏ä */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            }

            .header,
            .quiz-container,
            .results-container {
                background: rgba(45, 55, 72, 0.95);
                color: #e2e8f0;
            }

            .question-text {
                color: #e2e8f0;
            }

            .answer-btn {
                background: #4a5568;
                color: #e2e8f0;
                border-color: #718096;
            }

            .answer-btn:hover,
            .answer-btn:active {
                background: #2d3748;
                border-color: #667eea;
            }

            .mode-btn {
                background: #4a5568;
                color: #e2e8f0;
                border-color: #667eea;
            }

            .mode-btn.active,
            .mode-btn:hover {
                background: #667eea;
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Ëã±‰ºöË©±„ÇØ„Ç§„Ç∫</h1>
            <p>ÊóÖË°å„Åß‰Ωø„Åà„ÇãËã±‰ºöË©±„Éï„É¨„Éº„Ç∫„Çí„ÇØ„Ç§„Ç∫„ÅßÊ•Ω„Åó„ÅèÂ≠¶ÁøíÔºÅ<br>ÂÖ®130Âïè„Åã„ÇâÊØéÂõû„É©„É≥„ÉÄ„É†„Å´10ÂïèÂá∫È°å„Åï„Çå„Åæ„Åô</p>
            <div class="mode-selector" id="modeSelector">
                <button class="mode-btn active" onclick="selectMode('translate')">
                    üìù ÁøªË®≥„ÇØ„Ç§„Ç∫
                </button>
                <button class="mode-btn" onclick="selectMode('listening')">
                    üéß „É™„Çπ„Éã„É≥„Ç∞„ÇØ„Ç§„Ç∫
                </button>
                <button class="mode-btn" onclick="selectMode('speaking')">
                    üé§ Áô∫Èü≥„ÇØ„Ç§„Ç∫
                </button>
                <button class="mode-btn" onclick="selectMode('dictation')">
                    ‚úçÔ∏è „Éá„Ç£„ÇØ„ÉÜ„Éº„Ç∑„Éß„É≥
                </button>
            </div>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="start-screen" id="startScreen">
                <h2>üìù ÁøªË®≥„ÇØ„Ç§„Ç∫</h2>
                <p>
                    Êó•Êú¨Ë™û„ÅÆ„Éï„É¨„Éº„Ç∫„ÇíË¶ã„Å¶„ÄÅÊ≠£„Åó„ÅÑËã±Ë®≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
                    130Âïè„ÅÆ‰∏≠„Åã„Çâ„É©„É≥„ÉÄ„É†„Å´10ÂïèÂá∫È°å„Åï„Çå„Åæ„ÅôÔºÅ
                </p>
                
                <!-- „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏Êäû -->
                <div class="category-selector" style="margin: 20px 0;">
                    <h3 style="font-size: 1.2em; margin-bottom: 10px; color: #667eea;">
                        <i class="fas fa-folder-open"></i> „Ç´„ÉÜ„Ç¥„É™„Éº„ÇíÈÅ∏Êäû
                    </h3>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="category-btn active" onclick="selectCategory('all')" 
                                style="padding: 8px 15px; border: 2px solid #667eea; background: #667eea; color: white; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            <i class="fas fa-globe"></i> ÂÖ®„Å¶ (130Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('greeting')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üôã Êå®Êã∂ (3Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('airport')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            ‚úàÔ∏è Á©∫Ê∏Ø (24Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('hotel')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üè® „Éõ„ÉÜ„É´ (16Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('restaurant')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üçΩÔ∏è „É¨„Çπ„Éà„É©„É≥ (26Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('shopping')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üõçÔ∏è Ë≤∑„ÅÑÁâ© (20Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('transportation')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üöï ‰∫§ÈÄö (19Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('emergency')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üö® Á∑äÊÄ•ÊôÇ (18Âïè)
                        </button>
                        <button class="category-btn" onclick="selectCategory('communication')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üí¨ ‰ºöË©± (4Âïè)
                        </button>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startQuiz()">
                    „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã üöÄ
                </button>
                <br><br>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="voice-btn" onclick="testVoice()" style="font-size: 0.9em; padding: 10px 20px;">
                        üîä Èü≥Â£∞„ÉÜ„Çπ„Éà
                    </button>
                    <button class="voice-btn" onclick="checkVoiceQuality()" style="font-size: 0.9em; padding: 10px 20px; background: #673ab7;">
                        üéØ Èü≥Â£∞ÂìÅË≥™Ë®∫Êñ≠
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Éï„É¨„Éº„Ç∫„Éá„Éº„ÇøÔºàÊã°ÂºµÁâàÔºâ
        const phrases = [
            // Âü∫Êú¨ÁöÑ„Å™Êå®Êã∂
            { id: 1, japanese: "„Åì„Çì„Å´„Å°„ÅØ", english: "Hello", category: "greeting", difficulty: 1 },
            { id: 2, japanese: "„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô", english: "Thank you", category: "greeting", difficulty: 1 },
            { id: 3, japanese: "„Åô„Åø„Åæ„Åõ„Çì", english: "Excuse me", category: "greeting", difficulty: 1 },
            
            // Á©∫Ê∏Ø - „Éï„É©„Ç§„ÉàÁ¢∫Ë™ç
            { id: 4, japanese: "„Éï„É©„Ç§„Éà„ÇíÁ¢∫Ë™ç„Åó„Åü„ÅÑ„ÅÆ„Åß„Åô„Åå", english: "I want to confirm my flight", category: "airport", difficulty: 2 },
            { id: 5, japanese: "„ÉÅ„Ç±„ÉÉ„ÉàÁï™Âè∑„ÇíÊïô„Åà„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you tell me your ticket number?", category: "airport", difficulty: 2 },
            { id: 6, japanese: "Áï™Âè∑„ÅØ...„Åß„Åô", english: "The number is...", category: "airport", difficulty: 1 },
            { id: 7, japanese: "„ÉÅ„Ç±„ÉÉ„Éà„ÅØÁ¢∫Ë™ç„Åï„Çå„Åæ„Åó„Åü", english: "Your tickets are confirmed", category: "airport", difficulty: 2 },
            
            // Á©∫Ê∏Ø - „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥
            { id: 8, japanese: "„ÉÅ„Ç±„ÉÉ„Éà„Å®ID„ÇíË¶ã„Åõ„Å¶„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÅãÔºü", english: "Can I see your ticket and ID, please?", category: "airport", difficulty: 2 },
            { id: 9, japanese: "„ÅØ„ÅÑ„ÄÅ„Å©„ÅÜ„Åû", english: "Sure, here you go", category: "airport", difficulty: 1 },
            { id: 10, japanese: "‰ªäÊó•‰ªñ„Å´‰∏ÄÁ∑í„Å´ÊóÖË°å„Åï„Çå„ÇãÊñπ„ÅØ„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åô„ÅãÔºü", english: "Is anybody else traveling with you today?", category: "airport", difficulty: 3 },
            { id: 11, japanese: "„ÅÑ„ÅÑ„Åà„ÄÅ‰∏Ä‰∫∫„ÅßÊóÖË°å„Åó„Å¶„ÅÑ„Åæ„Åô", english: "No, I'm traveling alone", category: "airport", difficulty: 2 },
            
            // Á©∫Ê∏Ø - „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë≥™Âïè
            { id: 12, japanese: "Áü•„Çâ„Å™„ÅÑ‰∫∫„Åã„Çâ‰Ωï„Åã„ÇíÈ£õË°åÊ©ü„Å´ÊåÅ„Å°Ëæº„ÇÄ„Çà„ÅÜÈ†º„Åæ„Çå„Åæ„Åó„Åü„ÅãÔºü", english: "Did someone you don't know ask you to take something on the plane?", category: "airport", difficulty: 3 },
            { id: 13, japanese: "ÊâãËç∑Áâ©„ÇíÊîæÁΩÆ„Åó„Åü„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Did you leave your baggage unattended at any time?", category: "airport", difficulty: 3 },
            { id: 14, japanese: "Ê≠¶Âô®„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü", english: "Are you carrying any weapons?", category: "airport", difficulty: 2 },
            { id: 15, japanese: "Áî≥Âëä„Åô„Çã„ÇÇ„ÅÆ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have anything to declare?", category: "airport", difficulty: 2 },
            
            // Á©∫Ê∏Ø - „Ç≤„Éº„ÉàÊ°àÂÜÖ
            { id: 16, japanese: "„Ç≤„Éº„Éà„ÅØ„Å©„Åì„Åß„Åó„Åü„Å£„ÅëÔºü", english: "Which gate did you say it was?", category: "airport", difficulty: 2 },
            { id: 17, japanese: "„Ç≤„Éº„ÉàÁï™Âè∑„ÅØ‰ΩïÁï™„Åß„Åó„Åü„Å£„ÅëÔºü", english: "What was the gate number again?", category: "airport", difficulty: 2 },
            { id: 18, japanese: "„Ç≤„Éº„Éà„ÅÆÊñπÂêë„ÇíÊïô„Åà„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you point me toward the gate?", category: "airport", difficulty: 2 },
            { id: 19, japanese: "5Áï™„Ç≤„Éº„Éà„Å´„ÅØ„Å©„ÅÜ„ÇÑ„Å£„Å¶Ë°å„Åë„Å∞„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü", english: "How do I get to gate number 5?", category: "airport", difficulty: 2 },
            
            // Á©∫Ê∏Ø - „Ç≤„Éº„Éà„Ç¢„Éä„Ç¶„É≥„Çπ
            { id: 20, japanese: "„Ç≤„Éº„Éà„ÅåÂ§âÊõ¥„Å´„Å™„Çä„Åæ„Åó„Åü", english: "There has been a gate change", category: "airport", difficulty: 2 },
            { id: 21, japanese: "„Éã„É•„Éº„É®„Éº„ÇØË°å„Åç„ÅÆ237‰æø„ÅÆÊê≠‰πó„ÅåÂßã„Åæ„Çä„Åæ„Åó„Åü", english: "Flight 237 to New York is now boarding", category: "airport", difficulty: 3 },
            { id: 22, japanese: "156‰æø„ÅØÂ§©ÂÄô„ÅÆÂΩ±Èüø„ÅßÈÅÖ„Çå„Å¶„ÅÑ„Åæ„Åô", english: "Flight 156 has been delayed due to weather conditions", category: "airport", difficulty: 3 },
            { id: 23, japanese: "89‰æø„ÅØÊ¨†Ëà™„Å´„Å™„Çä„Åæ„Åó„Åü", english: "Flight 89 has been canceled", category: "airport", difficulty: 2 },
            
            // Ê©üÂÜÖ
            { id: 24, japanese: "„ÅîÊê≠‰πó„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô", english: "Welcome aboard", category: "airport", difficulty: 1 },
            { id: 25, japanese: "„Ç∑„Éº„Éà„Éô„É´„Éà„Çí„ÅäÁ∑†„ÇÅ„Åè„Å†„Åï„ÅÑ", english: "Please fasten your seatbelt", category: "airport", difficulty: 1 },
            { id: 26, japanese: "„Ç∑„Éº„Éà„ÇíÂÖÉ„Å´Êàª„Åó„Å¶„Åè„Å†„Åï„ÅÑ", english: "Please put your seat back upright", category: "airport", difficulty: 2 },
            { id: 27, japanese: "‰π±Ê∞óÊµÅ„Å´ÈÅ≠ÈÅá„Åó„Å¶„ÅÑ„Åæ„Åô", english: "We're experiencing some turbulence", category: "airport", difficulty: 2 },
            
            // „Éõ„ÉÜ„É´ - „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥
            { id: 28, japanese: "[ÂêçÂâç]„Åß‰∫àÁ¥Ñ„Åó„Å¶„ÅÑ„Åæ„Åô", english: "I have a reservation under [Your Name]", category: "hotel", difficulty: 2 },
            { id: 29, japanese: "Êó©„ÇÅ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„ÅØÂèØËÉΩ„Åß„Åô„ÅãÔºü", english: "Can I get an early check-in?", category: "hotel", difficulty: 2 },
            { id: 30, japanese: "„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„ÅØ‰ΩïÊôÇ„Åß„Åô„ÅãÔºü", english: "What time is check-out?", category: "hotel", difficulty: 1 },
            { id: 31, japanese: "ÈÅÖ„ÇÅ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„ÅØÂèØËÉΩ„Åß„Åô„ÅãÔºü", english: "Can I get a late check-out?", category: "hotel", difficulty: 2 },
            
            // „Éõ„ÉÜ„É´ - ÈÉ®Â±ã„ÅÆË®≠ÂÇô
            { id: 32, japanese: "ÈÉ®Â±ã„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô", english: "There's an issue with my room", category: "hotel", difficulty: 2 },
            { id: 33, japanese: "„Ç®„Ç¢„Ç≥„É≥„ÅåÂãï„Åç„Åæ„Åõ„Çì", english: "The air conditioning isn't working", category: "hotel", difficulty: 2 },
            { id: 34, japanese: "„Çø„Ç™„É´„ÇíËøΩÂä†„Åß„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get extra towels?", category: "hotel", difficulty: 1 },
            { id: 35, japanese: "Êûï„ÇíËøΩÂä†„Åß„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get extra pillows?", category: "hotel", difficulty: 1 },
            
            // „Éõ„ÉÜ„É´ - „Çµ„Éº„Éì„Çπ
            { id: 36, japanese: "„É´„Éº„É†„Çµ„Éº„Éì„Çπ„ÅØÂà©Áî®„Åß„Åç„Åæ„Åô„ÅãÔºü", english: "Can I get room service?", category: "hotel", difficulty: 2 },
            { id: 37, japanese: "Wi-Fi„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü„Å©„ÅÜ„ÇÑ„Å£„Å¶Êé•Á∂ö„Åó„Åæ„Åô„ÅãÔºü", english: "Is there Wi-Fi, and how do I connect?", category: "hotel", difficulty: 2 },
            { id: 38, japanese: "„Ç∏„É†„ÅØ„Å©„Åì„Å´„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Where can I find the gym?", category: "hotel", difficulty: 1 },
            { id: 39, japanese: "„Çø„ÇØ„Ç∑„Éº„ÇíÂëº„Çì„Åß„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you call a taxi for me?", category: "hotel", difficulty: 2 },
            
            // „Éõ„ÉÜ„É´ - Ê°àÂÜÖ„ÉªÊé®Ëñ¶
            { id: 40, japanese: "Ëøë„Åè„ÅÆ„ÅÑ„ÅÑ„É¨„Çπ„Éà„É©„É≥„ÇíÊïô„Åà„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you recommend a good restaurant nearby?", category: "hotel", difficulty: 2 },
            { id: 41, japanese: "„ÉÄ„Ç¶„É≥„Çø„Ç¶„É≥„Å∏„ÅÆÊúÄËâØ„ÅÆ„Ç¢„ÇØ„Çª„ÇπÊñπÊ≥ï„ÅØÔºü", english: "What's the best way to get downtown?", category: "hotel", difficulty: 2 },
            { id: 42, japanese: "Ê≠©„ÅÑ„Å¶Ë°å„Åë„ÇãË¶≥ÂÖâÂú∞„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Are there any attractions within walking distance?", category: "hotel", difficulty: 3 },
            { id: 43, japanese: "„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Åæ„ÅßËç∑Áâ©„ÇíÈ†ê„Åã„Å£„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Could you keep my luggage until check-in?", category: "hotel", difficulty: 2 },
            
            // „É¨„Çπ„Éà„É©„É≥ - ÂÖ•Â∫ó„ÉªÂ∏≠„ÅÆÊ°àÂÜÖ
            { id: 44, japanese: "‰∫å‰∫∫Áî®„ÅÆ„ÉÜ„Éº„Éñ„É´„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", english: "Table for two, please", category: "restaurant", difficulty: 1 },
            { id: 45, japanese: "„Åî‰∫àÁ¥Ñ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have a reservation?", category: "restaurant", difficulty: 1 },
            { id: 46, japanese: "„Å©„ÅÆ„Åè„Çâ„ÅÑÂæÖ„Å°„Åæ„Åô„ÅãÔºü", english: "How long is the wait?", category: "restaurant", difficulty: 1 },
            { id: 47, japanese: "Á™ìÈöõ„ÅÆÂ∏≠„Å´Â∫ß„Çå„Åæ„Åô„ÅãÔºü", english: "Can we sit by the window?", category: "restaurant", difficulty: 2 },
            
            // „É¨„Çπ„Éà„É©„É≥ - Ê≥®Êñá
            { id: 48, japanese: "„É°„Éã„É•„Éº„ÇíË¶ã„Åõ„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I see the menu, please?", category: "restaurant", difficulty: 1 },
            { id: 49, japanese: "‰Ωï„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„ÅãÔºü", english: "What do you recommend?", category: "restaurant", difficulty: 2 },
            { id: 50, japanese: "„ÉÅ„Ç≠„É≥„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", english: "I'll have the chicken, please", category: "restaurant", difficulty: 1 },
            { id: 51, japanese: "„Å©„ÅÆ„Çà„ÅÜ„Å´Ë™øÁêÜ„Åó„Åæ„Åô„ÅãÔºü", english: "How would you like that cooked?", category: "restaurant", difficulty: 2 },
            { id: 52, japanese: "„Éü„Éá„Ç£„Ç¢„É†„É¨„Ç¢„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", english: "Medium rare, please", category: "restaurant", difficulty: 2 },
            { id: 53, japanese: "„Åì„Çå„ÇíÂà•Ê∑ª„Åà„Åß„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get this on the side?", category: "restaurant", difficulty: 2 },
            
            // „É¨„Çπ„Éà„É©„É≥ - È£≤„ÅøÁâ©
            { id: 54, japanese: "„ÉØ„Ç§„É≥„É™„Çπ„Éà„ÇíË¶ã„Åõ„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I see the wine list?", category: "restaurant", difficulty: 2 },
            { id: 55, japanese: "Ëµ§„ÉØ„Ç§„É≥„Çí„Ç∞„É©„Çπ„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", english: "I'll have a glass of red wine", category: "restaurant", difficulty: 2 },
            { id: 56, japanese: "ÁßÅ„ÅØÊ∞¥„Å†„Åë„ÅßÁµêÊßã„Åß„Åô", english: "Just water for me, please", category: "restaurant", difficulty: 1 },
            { id: 57, japanese: "„Åä„Åã„Çè„Çä„Çí„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get a refill?", category: "restaurant", difficulty: 1 },
            
            // „É¨„Çπ„Éà„É©„É≥ - È£ü‰∫ã‰∏≠„ÉªËøΩÂä†Ê≥®Êñá
            { id: 58, japanese: "„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü", english: "How is everything?", category: "restaurant", difficulty: 1 },
            { id: 59, japanese: "„Åô„Åπ„Å¶ÁæéÂë≥„Åó„ÅÑ„Åß„ÅôÔºÅ", english: "Everything is delicious!", category: "restaurant", difficulty: 1 },
            { id: 60, japanese: "„Éë„É≥„Çí„ÇÇ„ÅÜÂ∞ë„Åó„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get some more bread?", category: "restaurant", difficulty: 1 },
            { id: 61, japanese: "„Ç±„ÉÅ„É£„ÉÉ„Éó„ÇíÊåÅ„Å£„Å¶„Åç„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Could you bring me some ketchup?", category: "restaurant", difficulty: 2 },
            
            // „É¨„Çπ„Éà„É©„É≥ - ‰ºöË®à
            { id: 62, japanese: "‰ºöË®à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", english: "Can I get the check, please?", category: "restaurant", difficulty: 1 },
            { id: 63, japanese: "Ââ≤„ÇäÂãò„Å´„Åó„Åæ„Åô", english: "We'll split the bill", category: "restaurant", difficulty: 2 },
            { id: 64, japanese: "„ÉÅ„ÉÉ„Éó„ÅØÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü", english: "Is the tip included?", category: "restaurant", difficulty: 2 },
            { id: 65, japanese: "„ÅäÈá£„Çä„ÅØ„Å®„Å£„Å¶„Åä„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ", english: "Keep the change", category: "restaurant", difficulty: 1 },
            
            // „É¨„Çπ„Éà„É©„É≥ - Ëã¶ÊÉÖ„ÉªÁâπÂà•„Å™Ë¶ÅÊ±Ç
            { id: 66, japanese: "„Åì„Çå„ÅØÊ≥®Êñá„Åó„Åü„ÇÇ„ÅÆ„Å®ÈÅï„ÅÑ„Åæ„Åô", english: "This isn't what I ordered", category: "restaurant", difficulty: 2 },
            { id: 67, japanese: "„Åì„Çå„Çí‰∏ã„Åí„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you take this back?", category: "restaurant", difficulty: 2 },
            { id: 68, japanese: "„Éä„ÉÉ„ÉÑ„Ç¢„É¨„É´„ÇÆ„Éº„Åß„Åô", english: "I'm allergic to nuts", category: "restaurant", difficulty: 2 },
            { id: 69, japanese: "ÊåÅ„Å°Â∏∞„ÇäÁî®„ÅÆÁÆ±„Çí„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get a to-go box?", category: "restaurant", difficulty: 1 },
            
            // Ë≤∑„ÅÑÁâ© - ÂïÜÂìÅÊé¢„Åó
            { id: 70, japanese: "„Åô„Åø„Åæ„Åõ„Çì„ÄÅ...„ÅØ„Å©„Åì„ÅßË¶ã„Å§„Åë„Çâ„Çå„Åæ„Åô„ÅãÔºü", english: "Excuse me, where can I find...?", category: "shopping", difficulty: 2 },
            { id: 71, japanese: "„Åì„Çå„ÅÆÈÅï„ÅÜ„Çµ„Ç§„Ç∫„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have this in a different size?", category: "shopping", difficulty: 2 },
            { id: 72, japanese: "„Åì„Çå„ÅÆÈÅï„ÅÜËâ≤„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have this in a different color?", category: "shopping", difficulty: 2 },
            { id: 73, japanese: "Ë¶ã„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ", english: "I'm just looking, thanks", category: "shopping", difficulty: 1 },
            
            // Ë≤∑„ÅÑÁâ© - ‰æ°Ê†º„ÉªÊîØÊâï„ÅÑ
            { id: 74, japanese: "„Åì„Çå„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü", english: "How much is this?", category: "shopping", difficulty: 1 },
            { id: 75, japanese: "„Åì„Çå„ÅØ„Çª„Éº„É´‰∏≠„Åß„Åô„ÅãÔºü", english: "Is this on sale?", category: "shopping", difficulty: 1 },
            { id: 76, japanese: "„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„Éâ„ÅØ‰Ωø„Åà„Åæ„Åô„ÅãÔºü", english: "Do you accept credit cards?", category: "shopping", difficulty: 2 },
            { id: 77, japanese: "ÁèæÈáë„ÅßÊîØÊâï„Åà„Åæ„Åô„ÅãÔºü", english: "Can I pay with cash?", category: "shopping", difficulty: 1 },
            
            // Ë≤∑„ÅÑÁâ© - Ë©¶ÁùÄ„ÉªËøîÂìÅ
            { id: 78, japanese: "„Åì„Çå„ÇíË©¶ÁùÄ„Åß„Åç„Åæ„Åô„ÅãÔºü", english: "Can I try this on?", category: "shopping", difficulty: 1 },
            { id: 79, japanese: "Ë©¶ÁùÄÂÆ§„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü", english: "Where is the fitting room?", category: "shopping", difficulty: 1 },
            { id: 80, japanese: "„Åì„Çå„ÅØ„Çµ„Ç§„Ç∫„ÅåÂêà„ÅÑ„Åæ„Åõ„Çì", english: "This doesn't fit", category: "shopping", difficulty: 1 },
            { id: 81, japanese: "„Åì„Çå„ÇíËøîÂìÅ„Åß„Åç„Åæ„Åô„ÅãÔºü", english: "Can I return this?", category: "shopping", difficulty: 2 },
            
            // Ë≤∑„ÅÑÁâ© - „É¨„Ç∏„Éª‰ºöË®à
            { id: 82, japanese: "„Åì„Çå„Çí„Åè„Å†„Åï„ÅÑ", english: "I'll take this", category: "shopping", difficulty: 1 },
            { id: 83, japanese: "„É¨„Ç∑„Éº„Éà„Çí„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I get a receipt?", category: "shopping", difficulty: 1 },
            { id: 84, japanese: "Ë¢ã„ÅØÂøÖË¶Å„Åß„Åô„ÅãÔºü", english: "Do you need a bag?", category: "shopping", difficulty: 1 },
            { id: 85, japanese: "Ë¢ã„ÅØÁµêÊßã„Åß„Åô„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ", english: "No bag, thanks", category: "shopping", difficulty: 1 },
            
            // Ë≤∑„ÅÑÁâ© - Â∫óËàóÊÉÖÂ†±
            { id: 86, japanese: "‰ΩïÊôÇ„Å´ÈñãÂ∫ó„Åó„Åæ„Åô„ÅãÔºü", english: "What time do you open?", category: "shopping", difficulty: 1 },
            { id: 87, japanese: "‰ΩïÊôÇ„Å´ÈñâÂ∫ó„Åó„Åæ„Åô„ÅãÔºü", english: "What time do you close?", category: "shopping", difficulty: 1 },
            { id: 88, japanese: "‰ªäÊó•„ÅØ„Éó„É≠„É¢„Éº„Ç∑„Éß„É≥„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Are there any promotions today?", category: "shopping", difficulty: 2 },
            { id: 89, japanese: "„Çª„Éº„É´„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have any sales?", category: "shopping", difficulty: 1 },
            
            // ‰∫§ÈÄöÊ©üÈñ¢ - „Çø„ÇØ„Ç∑„Éº
            { id: 90, japanese: "Á©∫„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü", english: "Are you free?", category: "transportation", difficulty: 1 },
            { id: 91, japanese: "...„Åæ„ÅßË°å„Å£„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you take me to...?", category: "transportation", difficulty: 2 },
            { id: 92, japanese: "„ÅÑ„Åè„Çâ„Åè„Çâ„ÅÑ„Åã„Åã„Çä„Åæ„Åô„ÅãÔºü", english: "How much will it cost?", category: "transportation", difficulty: 2 },
            { id: 93, japanese: "„É°„Éº„Çø„Éº„Çí„Å§„Åë„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you turn on the meter?", category: "transportation", difficulty: 2 },
            { id: 94, japanese: "„Åì„Åì„ÅßÊ≠¢„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ", english: "Please stop here", category: "transportation", difficulty: 1 },
            
            // ‰∫§ÈÄöÊ©üÈñ¢ - Âú∞‰∏ãÈâÑ„Éª„Éê„Çπ
            { id: 95, japanese: "„Å©„Åì„Åß„ÉÅ„Ç±„ÉÉ„Éà„ÇíË≤∑„Åà„Åæ„Åô„ÅãÔºü", english: "Where can I buy a ticket?", category: "transportation", difficulty: 2 },
            { id: 96, japanese: "...„Å´Ë°å„Åè„ÅÆ„ÅØ„Å©„ÅÆÁ∑ö„Åß„Åô„ÅãÔºü", english: "Which line goes to...?", category: "transportation", difficulty: 2 },
            { id: 97, japanese: "„Åì„Çå„ÅØÊ≠£„Åó„ÅÑ„Éõ„Éº„É†„Åß„Åô„ÅãÔºü", english: "Is this the right platform?", category: "transportation", difficulty: 2 },
            { id: 98, japanese: "„Åì„ÅÆ„Éê„Çπ„ÅØ...„Å´Ë°å„Åç„Åæ„Åô„ÅãÔºü", english: "Does this bus go to...?", category: "transportation", difficulty: 2 },
            
            // ‰∫§ÈÄöÊ©üÈñ¢ - ÈÅìÊ°àÂÜÖ
            { id: 99, japanese: "„Åô„Åø„Åæ„Åõ„Çì„ÄÅ...„Å´„ÅØ„Å©„ÅÜ„ÇÑ„Å£„Å¶Ë°å„Åë„Å∞„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü", english: "Excuse me, how do I get to...?", category: "transportation", difficulty: 2 },
            { id: 100, japanese: "Ê≠©„ÅÑ„Å¶Ë°å„Åë„ÇãË∑ùÈõ¢„Åß„Åô„ÅãÔºü", english: "Is it within walking distance?", category: "transportation", difficulty: 2 },
            { id: 101, japanese: "„Åæ„Å£„Åô„ÅêË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ", english: "Go straight", category: "transportation", difficulty: 1 },
            { id: 102, japanese: "‰ø°Âè∑„ÅßÂ∑¶„Å´Êõ≤„Åå„Å£„Å¶„Åè„Å†„Åï„ÅÑ", english: "Turn left at the traffic light", category: "transportation", difficulty: 2 },
            { id: 103, japanese: "Âè≥Êâã„Å´„ÅÇ„Çä„Åæ„Åô", english: "It's on your right", category: "transportation", difficulty: 1 },
            { id: 104, japanese: "Ë¶ãÈÄÉ„Åô„Åì„Å®„ÅØ„Å™„ÅÑ„Åß„Åó„Çá„ÅÜ", english: "You can't miss it", category: "transportation", difficulty: 2 },
            
            // ‰∫§ÈÄöÊ©üÈñ¢ - „É¨„É≥„Çø„Ç´„Éº
            { id: 105, japanese: "Ëªä„ÇíÂÄü„Çä„Åü„ÅÑ„ÅÆ„Åß„Åô„Åå", english: "I'd like to rent a car", category: "transportation", difficulty: 2 },
            { id: 106, japanese: "„Ç≥„É≥„Éë„ÇØ„Éà„Ç´„Éº„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü", english: "Do you have any compact cars available?", category: "transportation", difficulty: 2 },
            { id: 107, japanese: "‰øùÈô∫„ÅØÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü", english: "Is insurance included?", category: "transportation", difficulty: 2 },
            { id: 108, japanese: "Ëªä„ÅØ„Å©„Åì„ÅßËøîÂç¥„Åó„Åæ„Åô„ÅãÔºü", english: "Where do I return the car?", category: "transportation", difficulty: 2 },
            
            // Á∑äÊÄ•ÊôÇ - Âü∫Êú¨ÁöÑ„Å™Á∑äÊÄ•ÊôÇ
            { id: 109, japanese: "Âä©„Åë„Å¶ÔºÅ", english: "Help!", category: "emergency", difficulty: 1 },
            { id: 110, japanese: "Âä©„Åë„ÅåÂøÖË¶Å„Åß„Åô", english: "I need help", category: "emergency", difficulty: 1 },
            { id: 111, japanese: "911„Å´ÈõªË©±„Åó„Å¶ÔºÅ", english: "Call 911!", category: "emergency", difficulty: 1 },
            { id: 112, japanese: "ÊïëÊÄ•Ëªä„ÇíÂëº„Çì„Åß„Åè„Å†„Åï„ÅÑ", english: "Please call an ambulance", category: "emergency", difficulty: 2 },
            
            // Á∑äÊÄ•ÊôÇ - ÂÅ•Â∫∑„ÉªÂåªÁôÇ
            { id: 113, japanese: "Ê∞óÂàÜ„Åå„Çà„Åè„ÅÇ„Çä„Åæ„Åõ„Çì", english: "I don't feel well", category: "emergency", difficulty: 1 },
            { id: 114, japanese: "È†≠Áóõ„Åå„Åó„Åæ„Åô", english: "I have a headache", category: "emergency", difficulty: 1 },
            { id: 115, japanese: "„ÇÅ„Åæ„ÅÑ„Åå„Åó„Åæ„Åô", english: "I feel dizzy", category: "emergency", difficulty: 1 },
            { id: 116, japanese: "ÊúÄÂØÑ„Çä„ÅÆÁóÖÈô¢„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü", english: "Where is the nearest hospital?", category: "emergency", difficulty: 2 },
            { id: 117, japanese: "...„Å´„Ç¢„É¨„É´„ÇÆ„Éº„Åå„ÅÇ„Çä„Åæ„Åô", english: "I'm allergic to...", category: "emergency", difficulty: 2 },
            { id: 118, japanese: "...„ÅÆËñ¨„ÇíÊúçÁî®„Åó„Å¶„ÅÑ„Åæ„Åô", english: "I take medication for...", category: "emergency", difficulty: 3 },
            
            // Á∑äÊÄ•ÊôÇ - ÁõóÈõ£„ÉªÁ¥õÂ§±
            { id: 119, japanese: "Ë≤°Â∏É„Çí„Å™„Åè„Åó„Åæ„Åó„Åü", english: "I lost my wallet", category: "emergency", difficulty: 1 },
            { id: 120, japanese: "„Éë„Çπ„Éù„Éº„Éà„ÇíÁõó„Åæ„Çå„Åæ„Åó„Åü", english: "My passport was stolen", category: "emergency", difficulty: 2 },
            { id: 121, japanese: "Ë≠¶ÂØüÁΩ≤„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü", english: "Where is the police station?", category: "emergency", difficulty: 2 },
            { id: 122, japanese: "Ë≠¶ÂØü„Å´Â±ä„ÅëÂá∫„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô", english: "I need to file a police report", category: "emergency", difficulty: 3 },
            
            // Á∑äÊÄ•ÊôÇ - ÈÄ£Áµ°ÂÖà„ÉªÂ§ß‰ΩøÈ§®
            { id: 123, japanese: "Êó•Êú¨Â§ß‰ΩøÈ§®„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü", english: "Where is the Japanese Embassy?", category: "emergency", difficulty: 2 },
            { id: 124, japanese: "Â§ß‰ΩøÈ§®„Å´ÈÄ£Áµ°„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô", english: "I need to contact my embassy", category: "emergency", difficulty: 3 },
            { id: 125, japanese: "ÈõªË©±„Çí‰Ωø„Çè„Åõ„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can I use your phone?", category: "emergency", difficulty: 1 },
            { id: 126, japanese: "ÁßÅ„ÅØÊó•Êú¨‰∫∫„Åß„Åô", english: "I'm Japanese", category: "emergency", difficulty: 1 },
            
            // Á∑äÊÄ•ÊôÇ - Ë®ÄËëâ„ÅÆÂ£Å
            { id: 127, japanese: "Ëã±Ë™û„ÇíË©±„Åõ„Åæ„Åô„ÅãÔºü", english: "Do you speak English?", category: "communication", difficulty: 1 },
            { id: 128, japanese: "ÁêÜËß£„Åß„Åç„Åæ„Åõ„Çì", english: "I don't understand", category: "communication", difficulty: 1 },
            { id: 129, japanese: "„ÇÜ„Å£„Åè„ÇäË©±„Åó„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you speak slowly?", category: "communication", difficulty: 2 },
            { id: 130, japanese: "Êõ∏„ÅÑ„Å¶„ÇÇ„Çâ„Åà„Åæ„Åô„ÅãÔºü", english: "Can you write it down?", category: "communication", difficulty: 2 }
        ];

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let currentMode = 'translate';
        let currentCategory = 'all'; // ÈÅ∏Êäû„Åï„Çå„Åü„Ç´„ÉÜ„Ç¥„É™„Éº
        let currentQuestionIndex = 0;
        let score = 0;
        let questions = [];
        let currentQuestion = null;
        let isAnswering = false;
        let recognition = null;
        let isSpeechAvailable = false;
        const QUESTIONS_PER_QUIZ = 10; // „ÇØ„Ç§„Ç∫1Âõû„ÅÇ„Åü„Çä„ÅÆÂïèÈ°åÊï∞

        // „Éñ„É©„Ç¶„Ç∂Ê§úÂá∫Èñ¢Êï∞
        function detectBrowser() {
            const ua = navigator.userAgent;
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            const isAndroid = /Android/i.test(ua);
            const isSafari = /Safari/i.test(ua) && !/Chrome/i.test(ua) && !/CriOS/i.test(ua);
            const isChrome = /Chrome/i.test(ua) || /CriOS/i.test(ua);
            
            return {
                isIOS,
                isAndroid,
                isSafari,
                isChrome,
                isMobile: isIOS || isAndroid,
                browser: isSafari ? 'Safari' : (isChrome ? 'Chrome' : 'Other')
            };
        }

        // Safari/Chrome „Å´ÊúÄÈÅ©Âåñ„Åï„Çå„ÅüÈü≥Â£∞ÈÅ∏Êäû
        function selectBestVoiceForBrowser(lang = 'en-US') {
            const voices = window.speechSynthesis.getVoices();
            const browser = detectBrowser();
            
            console.log(`„Éñ„É©„Ç¶„Ç∂: ${browser.browser}, iOS: ${browser.isIOS}, Android: ${browser.isAndroid}`);
            console.log('Âà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞Êï∞:', voices.length);
            
            let selectedVoice = null;
            
            // Safari (iOS)
            if (browser.isSafari && browser.isIOS) {
                // Safari iOS „ÅßÊúÄ„ÇÇËá™ÁÑ∂„Å™Èü≥Â£∞ÔºàÂÑ™ÂÖàÈ†Ü‰ΩçÈ†ÜÔºâ
                const safariPreferences = [
                    // Premium voices (Ë¶Å„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÄÅÊúÄÈ´òÂìÅË≥™)
                    { name: 'Samantha (Enhanced)', quality: 10 },
                    { name: 'Samantha', quality: 9 },
                    { name: 'Alex (Enhanced)', quality: 10 },
                    { name: 'Alex', quality: 9 },
                    { name: 'Allison (Enhanced)', quality: 9 },
                    { name: 'Ava (Enhanced)', quality: 9 },
                    { name: 'Susan (Enhanced)', quality: 8 },
                    { name: 'Tom (Enhanced)', quality: 8 },
                    // Standard voices („Éó„É™„Ç§„É≥„Çπ„Éà„Éº„É´)
                    { name: 'Karen', quality: 7 },
                    { name: 'Daniel', quality: 7 },
                    { name: 'Moira', quality: 6 },
                    { name: 'Rishi', quality: 6 }
                ];
                
                // ÊúÄÈ´òÂìÅË≥™„ÅÆÈü≥Â£∞„ÇíÊé¢„Åô
                for (const pref of safariPreferences) {
                    selectedVoice = voices.find(voice => 
                        voice.name.includes(pref.name.replace(' (Enhanced)', '')) &&
                        (pref.name.includes('Enhanced') ? voice.name.includes('Enhanced') : true)
                    );
                    if (selectedVoice) {
                        console.log(`SafariÈü≥Â£∞ÈÅ∏Êäû: ${selectedVoice.name} (ÂìÅË≥™: ${pref.quality}/10)`);
                        break;
                    }
                }
            }
            
            // Chrome (Android)
            else if (browser.isChrome && browser.isAndroid) {
                // Chrome Android „ÅßÊúÄ„ÇÇËá™ÁÑ∂„Å™Èü≥Â£∞
                const chromeAndroidPreferences = [
                    // Google „ÅÆÈ´òÂìÅË≥™Èü≥Â£∞„ÇíÂÑ™ÂÖà
                    /Google.*US.*English.*Female/i,  // ÊúÄ„ÇÇËá™ÁÑ∂„Å™Â•≥ÊÄßÈü≥Â£∞
                    /Google.*US.*English.*Male/i,    // Áî∑ÊÄßÈü≥Â£∞
                    /Google.*UK.*English.*Female/i,  // „Ç§„ÇÆ„É™„ÇπËã±Ë™ûÂ•≥ÊÄß
                    /Google.*UK.*English.*Male/i,    // „Ç§„ÇÆ„É™„ÇπËã±Ë™ûÁî∑ÊÄß
                    /English.*United States/i,       // ‰∏ÄËà¨ÁöÑ„Å™Á±≥ÂõΩËã±Ë™û
                    /en[-_]US/i                      // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                ];
                
                for (const pattern of chromeAndroidPreferences) {
                    selectedVoice = voices.find(voice => 
                        pattern.test(voice.name) && !voice.localService
                    );
                    if (selectedVoice) {
                        console.log(`Chrome AndroidÈü≥Â£∞ÈÅ∏Êäû: ${selectedVoice.name}`);
                        break;
                    }
                }
            }
            
            // Chrome (iOS) - WebKit„Éô„Éº„Çπ„Å™„ÅÆ„ÅßSafari„Å®Âêå„ÅòÈü≥Â£∞„Åå‰Ωø„Åà„Çã
            else if (browser.isChrome && browser.isIOS) {
                // iOS Chrome „ÅØ Safari „Å®Âêå„ÅòÈü≥Â£∞„Çí‰ΩøÁî®
                const iOSChromePreferences = [
                    'Samantha',
                    'Alex',
                    'Karen',
                    'Daniel'
                ];
                
                for (const name of iOSChromePreferences) {
                    selectedVoice = voices.find(voice => voice.name.includes(name));
                    if (selectedVoice) {
                        console.log(`Chrome iOSÈü≥Â£∞ÈÅ∏Êäû: ${selectedVoice.name}`);
                        break;
                    }
                }
            }
            
            // Chrome (Desktop)
            else if (browser.isChrome && !browser.isMobile) {
                const chromeDesktopPreferences = [
                    /Google US English/i,
                    /Google UK English.*Female/i,
                    /Google UK English.*Male/i,
                    /Microsoft.*Zira/i,
                    /Microsoft.*David/i
                ];
                
                for (const pattern of chromeDesktopPreferences) {
                    selectedVoice = voices.find(voice => pattern.test(voice.name));
                    if (selectedVoice) {
                        console.log(`Chrome DesktopÈü≥Â£∞ÈÅ∏Êäû: ${selectedVoice.name}`);
                        break;
                    }
                }
            }
            
            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
            if (!selectedVoice) {
                // „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÈü≥Â£∞„ÇíÂÑ™ÂÖàÔºàÈÄöÂ∏∏„ÅØÈ´òÂìÅË≥™Ôºâ
                selectedVoice = voices.find(voice => 
                    voice.lang.includes('en') && !voice.localService
                ) || voices.find(voice => voice.lang.includes('en'));
            }
            
            return selectedVoice;
        }

        // ÂàùÊúüÂåñÂá¶ÁêÜ
        window.addEventListener('DOMContentLoaded', function() {
            const browser = detectBrowser();
            console.log(`„Ç¢„Éó„É™Ëµ∑Âãï: ${browser.browser} on ${browser.isIOS ? 'iOS' : browser.isAndroid ? 'Android' : 'Desktop'}`);
            
            // Èü≥Â£∞ÂêàÊàêAPI„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
            if ('speechSynthesis' in window) {
                isSpeechAvailable = true;
                console.log('Èü≥Â£∞ÂêàÊàêAPIÂà©Áî®ÂèØËÉΩ');
                
                const initVoices = () => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        const bestVoice = selectBestVoiceForBrowser('en-US');
                        if (bestVoice) {
                            console.log(`Êé®Â•®Èü≥Â£∞Ë®≠ÂÆöÂÆå‰∫Ü: ${bestVoice.name}`);
                            
                            // Èü≥Â£∞„Ç®„É≥„Ç∏„É≥„Çí„Éó„É™„É≠„Éº„Éâ
                            const silent = new SpeechSynthesisUtterance('');
                            silent.voice = bestVoice;
                            silent.volume = 0;
                            speechSynthesis.speak(silent);
                        }
                    }
                };
                
                // Èü≥Â£∞„É™„Çπ„Éà„ÅÆË™≠„ÅøËæº„Åø
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = initVoices;
                } else {
                    setTimeout(initVoices, 100);
                }
                
                // Safari/ChromeÂà•„ÅÆÂàùÊúüÂåñ
                if (browser.isSafari && browser.isIOS) {
                    // iOS Safari„ÅÆÂàùÊúüÂåñ
                    document.addEventListener('click', function initSafari() {
                        const utterance = new SpeechSynthesisUtterance('');
                        utterance.volume = 0;
                        speechSynthesis.speak(utterance);
                        document.removeEventListener('click', initSafari);
                        console.log('Safari iOS Èü≥Â£∞ÂàùÊúüÂåñÂÆå‰∫Ü');
                    }, { once: true });
                }
                
            } else {
                console.error('Èü≥Â£∞ÂêàÊàêAPI„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ê©üËÉΩ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nChrome„ÄÅEdge„ÄÅSafariÁ≠â„ÅÆÊúÄÊñ∞„Éñ„É©„Ç¶„Ç∂„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        });

        // Èü≥Â£∞Ë™çË≠ò„ÅÆÂàùÊúüÂåñ
        function initSpeechRecognition() {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    console.error('Èü≥Â£∞Ë™çË≠ò„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return false;
                }
                
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 1;
                
                console.log('Èü≥Â£∞Ë™çË≠ò„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü');
                return true;
            } catch (error) {
                console.error('Èü≥Â£∞Ë™çË≠ò„ÅÆÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                return false;
            }
        }

        // „É¢„Éº„ÉâÈÅ∏Êäû
        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // „Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±„ÇíÂèñÂæó
            const browser = detectBrowser();
            
            // „Çπ„Çø„Éº„ÉàÁîªÈù¢„ÇíÊõ¥Êñ∞
            const startScreen = document.getElementById('startScreen');
            const modeInfo = {
                translate: {
                    title: 'üìù ÁøªË®≥„ÇØ„Ç§„Ç∫',
                    desc: 'Êó•Êú¨Ë™û„ÅÆ„Éï„É¨„Éº„Ç∫„ÇíË¶ã„Å¶„ÄÅÊ≠£„Åó„ÅÑËã±Ë®≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ'
                },
                listening: {
                    title: 'üéß „É™„Çπ„Éã„É≥„Ç∞„ÇØ„Ç§„Ç∫',
                    desc: 'Ëã±Ë™û„ÅÆÈü≥Â£∞„ÇíËÅû„ÅÑ„Å¶„ÄÅÊ≠£„Åó„ÅÑÊó•Êú¨Ë™ûË®≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ'
                },
                speaking: {
                    title: 'üé§ Áô∫Èü≥„ÇØ„Ç§„Ç∫',
                    desc: 'Êó•Êú¨Ë™û„ÇíË¶ã„Å¶„ÄÅËã±Ë™û„ÅßÁô∫Èü≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                },
                dictation: {
                    title: '‚úçÔ∏è „Éá„Ç£„ÇØ„ÉÜ„Éº„Ç∑„Éß„É≥',
                    desc: 'Ëã±Ë™û„ÅÆÈü≥Â£∞„ÇíËÅû„ÅÑ„Å¶„ÄÅÊ≠£„Åó„ÅèÊõ∏„ÅçÂèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                }
            };
            
            startScreen.innerHTML = `
                <h2>${modeInfo[mode].title}</h2>
                <p>${modeInfo[mode].desc}<br>130Âïè„ÅÆ‰∏≠„Åã„Çâ„É©„É≥„ÉÄ„É†„Å´10ÂïèÂá∫È°å„Åï„Çå„Åæ„ÅôÔºÅ</p>
                
                <!-- „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏Êäû -->
                <div class="category-selector" style="margin: 20px 0;">
                    <h3 style="font-size: 1.2em; margin-bottom: 10px; color: #667eea;">
                        <i class="fas fa-folder-open"></i> „Ç´„ÉÜ„Ç¥„É™„Éº„ÇíÈÅ∏Êäû
                    </h3>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="category-btn ${currentCategory === 'all' ? 'active' : ''}" 
                                onclick="selectCategory('all')" 
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'all' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'all' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            <i class="fas fa-globe"></i> ÂÖ®„Å¶ (130Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'greeting' ? 'active' : ''}" 
                                onclick="selectCategory('greeting')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'greeting' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'greeting' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üôã Êå®Êã∂ (3Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'airport' ? 'active' : ''}" 
                                onclick="selectCategory('airport')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'airport' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'airport' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            ‚úàÔ∏è Á©∫Ê∏Ø (24Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'hotel' ? 'active' : ''}" 
                                onclick="selectCategory('hotel')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'hotel' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'hotel' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üè® „Éõ„ÉÜ„É´ (16Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'restaurant' ? 'active' : ''}" 
                                onclick="selectCategory('restaurant')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'restaurant' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'restaurant' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üçΩÔ∏è „É¨„Çπ„Éà„É©„É≥ (26Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'shopping' ? 'active' : ''}" 
                                onclick="selectCategory('shopping')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'shopping' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'shopping' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üõçÔ∏è Ë≤∑„ÅÑÁâ© (20Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'transportation' ? 'active' : ''}" 
                                onclick="selectCategory('transportation')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'transportation' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'transportation' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üöï ‰∫§ÈÄö (19Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'emergency' ? 'active' : ''}" 
                                onclick="selectCategory('emergency')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'emergency' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'emergency' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üö® Á∑äÊÄ•ÊôÇ (18Âïè)
                        </button>
                        <button class="category-btn ${currentCategory === 'communication' ? 'active' : ''}" 
                                onclick="selectCategory('communication')"
                                style="padding: 8px 15px; border: 2px solid #667eea; background: ${currentCategory === 'communication' ? '#667eea' : 'white'}; 
                                       color: ${currentCategory === 'communication' ? 'white' : '#667eea'}; border-radius: 20px; cursor: pointer; font-size: 0.9em;">
                            üí¨ ‰ºöË©± (4Âïè)
                        </button>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startQuiz()">
                    „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã üöÄ
                </button>
                <br><br>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="voice-btn" onclick="testVoice()" style="font-size: 0.9em; padding: 10px 20px;">
                        üîä Èü≥Â£∞„ÉÜ„Çπ„Éà
                    </button>
                    <button class="voice-btn" onclick="checkVoiceQuality()" style="font-size: 0.9em; padding: 10px 20px; background: #673ab7;">
                        üéØ Èü≥Â£∞ÂìÅË≥™Ë®∫Êñ≠
                    </button>
                    ${mode === 'speaking' ? `
                        <button class="voice-btn" onclick="testMicrophone()" style="font-size: 0.9em; padding: 10px 20px; background: #ff9800;">
                            üé§ „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà
                        </button>
                    ` : ''}
                </div>
                <p style="color: #666; font-size: 0.85em; margin-top: 20px;">
                    ${browser.browser === 'Safari' && browser.isIOS ? 
                        'üí° Safari iOS„Çí„ÅîÂà©Áî®‰∏≠ÔºöÈ´òÂìÅË≥™Èü≥Â£∞(Samantha Enhanced)„ÅåÂà©Áî®ÂèØËÉΩ„Åß„Åô' :
                      browser.browser === 'Chrome' && browser.isAndroid ? 
                        'üí° Chrome Android„Çí„ÅîÂà©Áî®‰∏≠ÔºöGoogleÈü≥Â£∞„ÅßËá™ÁÑ∂„Å™Áô∫Èü≥„ÅåÂèØËÉΩ„Åß„Åô' :
                      browser.browser === 'Chrome' && browser.isIOS ? 
                        'üí° Chrome iOS„Çí„ÅîÂà©Áî®‰∏≠ÔºöSafariÂêåÊßò„ÅÆÈ´òÂìÅË≥™Èü≥Â£∞„ÅåÂà©Áî®ÂèØËÉΩ„Åß„Åô' :
                        'üí° Èü≥Â£∞ÂìÅË≥™Ë®∫Êñ≠„ÅßÊúÄÈÅ©„Å™Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô'
                    }
                </p>
                ${mode === 'speaking' ? `
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        ‚Äª Áô∫Èü≥„ÇØ„Ç§„Ç∫„ÇíÂßã„ÇÅ„ÇãÂâç„Å´„ÄÅ„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„ÅßÂãï‰ΩúÁ¢∫Ë™ç„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô
                    </p>
                ` : ''}
            `;
        }

        // „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏Êäû
        function selectCategory(category) {
            currentCategory = category;
            // „Ç´„ÉÜ„Ç¥„É™„Éº„Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.category-btn').forEach(btn => {
                const btnCategory = btn.getAttribute('onclick').match(/selectCategory\('(.+?)'\)/)[1];
                if (btnCategory === category) {
                    btn.style.background = '#667eea';
                    btn.style.color = 'white';
                    btn.classList.add('active');
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#667eea';
                    btn.classList.remove('active');
                }
            });
        }

        // „ÇØ„Ç§„Ç∫ÈñãÂßã
        async function startQuiz() {
            // Áô∫Èü≥„ÇØ„Ç§„Ç∫„ÅÆÂ†¥Âêà„ÄÅ‰∫ãÂâç„Å´„Éû„Ç§„ÇØË®±ÂèØ„ÇíÁ¢∫Ë™ç
            if (currentMode === 'speaking') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop());
                    console.log('„Éû„Ç§„ÇØË®±ÂèØÁ¢∫Ë™çÊ∏à„Åø');
                } catch (error) {
                    console.error('„Éû„Ç§„ÇØË®±ÂèØ„Ç®„É©„Éº:', error);
                    
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                        const confirmStart = confirm(
                            '‚ö†Ô∏è „Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåÊãíÂê¶„Åï„Çå„Å¶„ÅÑ„Åæ„Åô\n\n' +
                            'Áô∫Èü≥„ÇØ„Ç§„Ç∫„Åß„ÅØ„Éû„Ç§„ÇØ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ\n' +
                            '‰ª•‰∏ã„ÅÆÊâãÈ†Ü„ÅßË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö\n\n' +
                            '1. „Åì„ÅÆ„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„Çã\n' +
                            '2. „Ç¢„Éâ„É¨„Çπ„Éê„Éº„ÅÆüîí„Åæ„Åü„ÅØüì∑„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '3. „Äå„Éû„Ç§„ÇØ„Äç„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '4. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø\n\n' +
                            '„Éû„Ç§„ÇØ„Å™„Åó„ÅßÁ∂ö„Åë„Åæ„Åô„ÅãÔºüÔºàÈå≤Èü≥Ê©üËÉΩ„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„ÇìÔºâ'
                        );
                        if (!confirmStart) {
                            return;
                        }
                    } else {
                        const confirmStart = confirm(
                            '‚ö†Ô∏è „Éû„Ç§„ÇØ„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì\n\n' +
                            '„Ç®„É©„Éº: ' + error.message + '\n\n' +
                            '„Éû„Ç§„ÇØ„Å™„Åó„ÅßÁ∂ö„Åë„Åæ„Åô„ÅãÔºüÔºàÈå≤Èü≥Ê©üËÉΩ„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„ÇìÔºâ'
                        );
                        if (!confirmStart) {
                            return;
                        }
                    }
                }
            }
            
            currentQuestionIndex = 0;
            score = 0;
            
            // „Ç´„ÉÜ„Ç¥„É™„Éº„Å´Âøú„Åò„Å¶ÂïèÈ°å„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            let availableQuestions = [...phrases];
            if (currentCategory !== 'all') {
                availableQuestions = phrases.filter(p => p.category === currentCategory);
            }
            
            // ÂïèÈ°å„Åå10ÂïèÊú™Ê∫Ä„ÅÆÂ†¥Âêà„ÅÆÂá¶ÁêÜ
            if (availableQuestions.length < QUESTIONS_PER_QUIZ) {
                // ÂïèÈ°å„ÅåÂ∞ë„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®ÂïèÈ°å„Çí‰ΩøÁî®
                questions = [...availableQuestions].sort(() => Math.random() - 0.5);
            } else {
                // „É©„É≥„ÉÄ„É†„Å´10ÂïèÈÅ∏Êäû
                questions = [];
                const shuffled = [...availableQuestions].sort(() => Math.random() - 0.5);
                questions = shuffled.slice(0, QUESTIONS_PER_QUIZ);
            }
            
            initSpeechRecognition();
            showQuestion();
        }

        // Ë≥™ÂïèË°®Á§∫
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }
            
            currentQuestion = questions[currentQuestionIndex];
            isAnswering = false;
            
            const container = document.getElementById('quizContainer');
            container.innerHTML = `
                <div class="quiz-progress">
                    <div class="quiz-progress-bar" style="width: ${(currentQuestionIndex / questions.length) * 100}%"></div>
                </div>
                <div class="quiz-header">
                    <div class="quiz-counter">
                        ${currentQuestion.category === 'greeting' ? 'üôã' : 
                          currentQuestion.category === 'airport' ? '‚úàÔ∏è' :
                          currentQuestion.category === 'hotel' ? 'üè®' :
                          currentQuestion.category === 'restaurant' ? 'üçΩÔ∏è' :
                          currentQuestion.category === 'shopping' ? 'üõçÔ∏è' :
                          currentQuestion.category === 'transportation' ? 'üöï' :
                          currentQuestion.category === 'emergency' ? 'üö®' :
                          currentQuestion.category === 'communication' ? 'üí¨' : ''}
                        ÂïèÈ°å ${currentQuestionIndex + 1} / ${questions.length}
                    </div>
                    <div class="quiz-score">„Çπ„Ç≥„Ç¢: ${score}</div>
                </div>
                <div class="quiz-content" id="quizContent">
                    ${getQuestionContent()}
                </div>
            `;
            
            // „É¢„Éº„Éâ„Åî„Å®„ÅÆÂàùÊúüÂá¶ÁêÜ
            if (currentMode === 'listening') {
                // Â∞ë„ÅóÈÅÖÂª∂„ÇíÂÖ•„Çå„Å¶Èü≥Â£∞„ÇíÂÜçÁîüÔºàUI„ÅÆÊèèÁîª„ÇíÂæÖ„Å§Ôºâ
                setTimeout(() => {
                    console.log('„É™„Çπ„Éã„É≥„Ç∞„ÇØ„Ç§„Ç∫: Èü≥Â£∞„ÇíËá™ÂãïÂÜçÁîü');
                    playQuestionAudio();
                }, 1000);
            }
        }

        // Ë≥™Âïè„Ç≥„É≥„ÉÜ„É≥„ÉÑÁîüÊàê
        function getQuestionContent() {
            switch (currentMode) {
                case 'translate':
                    return `
                        <div class="question-text">${currentQuestion.japanese}</div>
                        <div class="answer-options">
                            ${generateMultipleChoice('english').map((option, index) => `
                                <button class="answer-btn" onclick="checkAnswer('${option}', this)">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    `;
                
                case 'listening':
                    return `
                        <div class="voice-controls">
                            <button class="voice-btn" onclick="playQuestionAudio()">
                                üîä „ÇÇ„ÅÜ‰∏ÄÂ∫¶ËÅû„Åè
                            </button>
                        </div>
                        <div class="question-text">„Å©„ÅÜ„ÅÑ„ÅÜÊÑèÂë≥„Åß„Åó„Çá„ÅÜ„ÅãÔºü</div>
                        <div class="answer-options">
                            ${generateMultipleChoice('japanese').map((option, index) => `
                                <button class="answer-btn" onclick="checkAnswer('${option}', this)">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    `;
                
                case 'speaking':
                    return `
                        <div class="question-text">${currentQuestion.japanese}</div>
                        <p style="color: #666; margin-bottom: 20px;">Ëã±Ë™û„ÅßÁô∫Èü≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                        <div class="voice-controls">
                            <button class="voice-btn" id="recordBtn" onclick="startRecording()">
                                üé§ Èå≤Èü≥ÈñãÂßã
                            </button>
                            <button class="voice-btn" onclick="playAnswer()">
                                üîä „ÅäÊâãÊú¨„ÇíËÅû„Åè
                            </button>
                        </div>
                        <div id="recognizedText" style="margin-top: 20px;"></div>
                        <div style="margin-top: 20px; font-size: 0.9em; color: #666;">
                            üí° „Éí„É≥„Éà: ÂàùÂõû„ÅØ„Éñ„É©„Ç¶„Ç∂„Åå„Éû„Ç§„ÇØ‰ΩøÁî®Ë®±ÂèØ„ÇíÊ±Ç„ÇÅ„Åæ„Åô„ÄÇ„ÄåË®±ÂèØ„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                        </div>
                    `;
                
                case 'dictation':
                    return `
                        <div class="voice-controls">
                            <button class="voice-btn" onclick="playQuestionAudio()">
                                üîä „ÇÇ„ÅÜ‰∏ÄÂ∫¶ËÅû„Åè
                            </button>
                        </div>
                        <div class="question-text">ËÅû„Åì„Åà„ÅüËã±Ë™û„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        <div class="input-container">
                            <input type="text" class="text-input" id="dictationInput" 
                                   placeholder="Ëã±Ë™û„ÇíÂÖ•Âäõ..." onkeypress="if(event.key==='Enter') checkDictation()">
                        </div>
                        <button class="submit-btn" onclick="checkDictation()">ÂõûÁ≠î„Åô„Çã</button>
                        <button class="hint-btn" onclick="showHint()">„Éí„É≥„Éà„ÇíË¶ã„Çã</button>
                        <div id="hintText"></div>
                    `;
            }
        }

        // ÈÅ∏ÊäûËÇ¢ÁîüÊàê
        function generateMultipleChoice(type) {
            const correct = currentQuestion[type];
            const options = [correct];
            
            // Âêå„Åò„Ç´„ÉÜ„Ç¥„É™„Éº„Åã„ÇâÂÑ™ÂÖàÁöÑ„Å´ÈÅ∏ÊäûËÇ¢„Çí‰ΩúÊàê
            let sameCategory = phrases
                .filter(p => p.id !== currentQuestion.id && p.category === currentQuestion.category)
                .map(p => p[type]);
            
            // Âêå„Åò„Ç´„ÉÜ„Ç¥„É™„Éº„Å´ÂçÅÂàÜ„Å™ÈÅ∏ÊäûËÇ¢„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰ªñ„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éº„Åã„Çâ„ÇÇÈÅ∏Êäû
            let otherCategory = phrases
                .filter(p => p.id !== currentQuestion.id && p.category !== currentQuestion.category)
                .map(p => p[type]);
            
            // „Åæ„ÅöÂêå„Åò„Ç´„ÉÜ„Ç¥„É™„Éº„Åã„ÇâÈÅ∏ÊäûËÇ¢„ÇíËøΩÂä†
            const shuffledSame = sameCategory.sort(() => Math.random() - 0.5);
            const shuffledOther = otherCategory.sort(() => Math.random() - 0.5);
            
            let addedCount = 0;
            for (let i = 0; i < shuffledSame.length && addedCount < 3; i++) {
                if (!options.includes(shuffledSame[i])) {
                    options.push(shuffledSame[i]);
                    addedCount++;
                }
            }
            
            // Ë∂≥„Çä„Å™„ÅÑÂàÜ„Çí‰ªñ„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éº„Åã„ÇâË£úÂÖÖ
            for (let i = 0; i < shuffledOther.length && addedCount < 3; i++) {
                if (!options.includes(shuffledOther[i])) {
                    options.push(shuffledOther[i]);
                    addedCount++;
                }
            }
            
            return options.sort(() => Math.random() - 0.5);
        }

        // Èü≥Â£∞ÂÜçÁîüÔºà„Éñ„É©„Ç¶„Ç∂ÊúÄÈÅ©ÂåñÁâàÔºâ
        function playQuestionAudio() {
            if (!window.speechSynthesis) {
                alert('Èü≥Â£∞Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                return;
            }
            
            try {
                window.speechSynthesis.cancel();
                
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(currentQuestion.english);
                    const browser = detectBrowser();
                    
                    // „Éñ„É©„Ç¶„Ç∂„Å´ÊúÄÈÅ©„Å™Èü≥Â£∞„ÇíÈÅ∏Êäû
                    const voice = selectBestVoiceForBrowser('en-US');
                    if (voice) {
                        utterance.voice = voice;
                    }
                    
                    // „Éñ„É©„Ç¶„Ç∂Âà•„ÅÆÊúÄÈÅ©ÂåñË®≠ÂÆö
                    if (browser.isSafari && browser.isIOS) {
                        // Safari iOS „ÅÆÊúÄÈÅ©Ë®≠ÂÆö
                        utterance.rate = 0.95;    // „Çè„Åö„Åã„Å´ÈÅÖ„ÇÅ
                        utterance.pitch = 1.0;    // Ê®ôÊ∫ñ„Éî„ÉÉ„ÉÅ
                        utterance.volume = 1.0;
                        
                        // SamanthaÈü≥Â£∞„ÅÆÂ†¥Âêà„ÅÆÁâπÂà•Ë™øÊï¥
                        if (voice && voice.name.includes('Samantha')) {
                            utterance.rate = 1.0;  // Samantha„ÅØÊ®ôÊ∫ñÈÄüÂ∫¶„ÅåÊúÄÈÅ©
                        }
                    } 
                    else if (browser.isChrome && browser.isAndroid) {
                        // Chrome Android „ÅÆÊúÄÈÅ©Ë®≠ÂÆö
                        utterance.rate = 0.85;    // „ÇÜ„Å£„Åè„Çä„ÇÅ
                        utterance.pitch = 1.02;   // „Çè„Åö„Åã„Å´È´ò„ÇÅ
                        utterance.volume = 1.0;
                    }
                    else if (browser.isChrome && browser.isIOS) {
                        // Chrome iOS (WebKit„Éô„Éº„Çπ)
                        utterance.rate = 0.95;
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;
                    }
                    else {
                        // „Åù„ÅÆ‰ªñ„ÅÆ„Éñ„É©„Ç¶„Ç∂
                        utterance.rate = 0.9;
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;
                    }
                    
                    utterance.lang = 'en-US';
                    
                    // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
                    utterance.onstart = () => {
                        console.log(`ÂÜçÁîüÈñãÂßã: ${voice?.name || '„Éá„Éï„Ç©„É´„Éà'} (${browser.browser})`);
                    };
                    
                    utterance.onerror = (event) => {
                        console.error('Èü≥Â£∞„Ç®„É©„Éº:', event);
                        // „Ç®„É©„ÉºÊôÇ„ÅØÁ∞°ÊòìË®≠ÂÆö„ÅßÂÜçË©¶Ë°å
                        retrySimpleVoice(currentQuestion.english);
                    };
                    
                    window.speechSynthesis.speak(utterance);
                    
                }, 100);
            } catch (error) {
                console.error('Èü≥Â£∞ÂÜçÁîü„Ç®„É©„Éº:', error);
            }
        }

        function playAnswer() {
            if (!window.speechSynthesis) {
                alert('Èü≥Â£∞Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                return;
            }
            
            try {
                window.speechSynthesis.cancel();
                
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(currentQuestion.english);
                    const browser = detectBrowser();
                    
                    const voice = selectBestVoiceForBrowser('en-US');
                    if (voice) {
                        utterance.voice = voice;
                    }
                    
                    // „ÅäÊâãÊú¨„ÅØ„Åï„Çâ„Å´„ÇÜ„Å£„Åè„Çä
                    if (browser.isSafari && browser.isIOS) {
                        utterance.rate = 0.8;
                        utterance.pitch = 1.0;
                    } else if (browser.isChrome && browser.isAndroid) {
                        utterance.rate = 0.75;
                        utterance.pitch = 1.02;
                    } else {
                        utterance.rate = 0.8;
                        utterance.pitch = 1.0;
                    }
                    
                    utterance.lang = 'en-US';
                    utterance.volume = 1.0;
                    
                    utterance.onerror = (event) => {
                        console.error('Èü≥Â£∞„Ç®„É©„Éº:', event);
                        retrySimpleVoice(currentQuestion.english);
                    };
                    
                    window.speechSynthesis.speak(utterance);
                    console.log('„ÅäÊâãÊú¨Èü≥Â£∞ÂÜçÁîü:', currentQuestion.english);
                }, 100);
            } catch (error) {
                console.error('Èü≥Â£∞ÂÜçÁîü„Ç®„É©„Éº:', error);
                alert('Èü≥Â£∞Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            }
        }

        // „Ç∑„É≥„Éó„É´„Å™ÂÜçË©¶Ë°åÈñ¢Êï∞
        function retrySimpleVoice(text) {
            try {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
                console.log('„Ç∑„É≥„Éó„É´Ë®≠ÂÆö„ÅßÂÜçÁîü');
            } catch (error) {
                console.error('ÂÜçË©¶Ë°å„ÇÇÂ§±Êïó:', error);
            }
        }

        // Èü≥Â£∞ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÊ©üËÉΩ
        function checkVoiceQuality() {
            const voices = window.speechSynthesis.getVoices();
            const browser = detectBrowser();
            const recommendedVoice = selectBestVoiceForBrowser('en-US');
            
            let qualityInfo = `
=== Èü≥Â£∞ÂìÅË≥™Ë®∫Êñ≠ÁµêÊûú ===
„Éñ„É©„Ç¶„Ç∂: ${browser.browser}
„Éá„Éê„Ç§„Çπ: ${browser.isIOS ? 'iOS' : browser.isAndroid ? 'Android' : 'PC'}
Âà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞Êï∞: ${voices.length}
Êé®Â•®Èü≥Â£∞: ${recommendedVoice ? recommendedVoice.name : '„Å™„Åó'}
`;
            
            // „Éñ„É©„Ç¶„Ç∂Âà•„ÅÆ„Ç¢„Éâ„Éê„Ç§„Çπ
            if (browser.isSafari && browser.isIOS) {
                qualityInfo += `

„ÄêSafari iOS„É¶„Éº„Ç∂„Éº„Å∏„Äë
ÊúÄÈ´òÂìÅË≥™„ÅÆÈü≥Â£∞„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØÔºö
1. Ë®≠ÂÆö > „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ > Ë™≠„Åø‰∏ä„Åí„Ç≥„É≥„ÉÜ„É≥„ÉÑ
2. Â£∞ > Ëã±Ë™û > Samantha (Êã°Âºµ) „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
‚Äª EnhancedÁâà„ÅØÁ¥Ñ200MB„Åß„Åô„Åå„ÄÅÈùûÂ∏∏„Å´Ëá™ÁÑ∂„Å™Èü≥Â£∞„Åß„Åô`;
            } else if (browser.isChrome && browser.isAndroid) {
                qualityInfo += `

„ÄêChrome Android„É¶„Éº„Ç∂„Éº„Å∏„Äë
Èü≥Â£∞ÂìÅË≥™„ÇíÂêë‰∏ä„Åï„Åõ„Çã„Å´„ÅØÔºö
1. Ë®≠ÂÆö > Ë®ÄË™û„Å®ÂÖ•Âäõ > „ÉÜ„Ç≠„Çπ„ÉàË™≠„Åø‰∏ä„Åí
2. ÂÑ™ÂÖà„Åô„Çã„Ç®„É≥„Ç∏„É≥ > Google „ÇíÈÅ∏Êäû
3. Ë®≠ÂÆö„ÅßÈ´òÂìÅË≥™Èü≥Â£∞„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ`;
            }
            
            console.log(qualityInfo);
            alert(qualityInfo);
        }

        // ÂõûÁ≠î„ÉÅ„Çß„ÉÉ„ÇØÔºàÈÅ∏ÊäûÂºèÔºâ
        function checkAnswer(answer, button) {
            if (isAnswering) return;
            isAnswering = true;
            
            const correct = currentMode === 'listening' ? currentQuestion.japanese : currentQuestion.english;
            const isCorrect = answer === correct;
            
            button.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                score++;
                let feedbackMessage = 'Ê≠£Ëß£ÔºÅüéâ';
                
                // „É™„Çπ„Éã„É≥„Ç∞„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅÊ≠£Ëß£„ÅÆËã±Êñá„ÇíËøΩÂä†Ë°®Á§∫
                if (currentMode === 'listening') {
                    feedbackMessage += `<br><br>Ëã±Êñá: <strong>"${currentQuestion.english}"</strong>`;
                }
                
                showFeedback(true, feedbackMessage);
                
                // Ê≠£Ëß£„ÅÆÂ†¥Âêà„ÄÅËã±Ë™û„Éï„É¨„Éº„Ç∫„ÇíË™≠„Åø‰∏ä„Åí„ÇãÔºàÁøªË®≥„É¢„Éº„Éâ„Å®„É™„Çπ„Éã„É≥„Ç∞„É¢„Éº„Éâ‰∏°ÊñπÔºâ
                if (isSpeechAvailable && (currentMode === 'translate' || currentMode === 'listening')) {
                    setTimeout(() => {
                        try {
                            const utterance = new SpeechSynthesisUtterance(currentQuestion.english);
                            const voice = selectBestVoiceForBrowser('en-US');
                            if (voice) utterance.voice = voice;
                            utterance.lang = 'en-US';
                            utterance.rate = 0.9;
                            window.speechSynthesis.speak(utterance);
                        } catch (error) {
                            console.error('Ê≠£Ëß£Èü≥Â£∞„Ç®„É©„Éº:', error);
                        }
                    }, 500);
                }
            } else {
                let feedbackMessage = `‰∏çÊ≠£Ëß£... Ê≠£Ëß£„ÅØ„Äå${correct}„Äç„Åß„Åó„Åü`;
                
                // „É™„Çπ„Éã„É≥„Ç∞„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅÊ≠£Ëß£„ÅÆËã±Êñá„Å®ÈÅ∏Êäû„Åó„ÅüÁ≠î„Åà„ÅÆËã±Êñá„ÇíË°®Á§∫
                if (currentMode === 'listening') {
                    feedbackMessage += `<br><br>Ê≠£Ëß£„ÅÆËã±Êñá: <strong>"${currentQuestion.english}"</strong>`;
                    
                    // „É¶„Éº„Ç∂„Éº„ÅåÈÅ∏„Çì„Å†ÈÅ∏ÊäûËÇ¢„Å´ÂØæÂøú„Åô„ÇãËã±Êñá„ÇíÊé¢„Åô
                    const selectedPhrase = phrases.find(p => p.japanese === answer);
                    if (selectedPhrase && selectedPhrase.english !== currentQuestion.english) {
                        feedbackMessage += `<br>„ÅÇ„Å™„Åü„ÅåÈÅ∏„Çì„Å†„Äå${answer}„Äç„ÅÆËã±Êñá: <strong>"${selectedPhrase.english}"</strong>`;
                    }
                }
                
                showFeedback(false, feedbackMessage);
                
                // Ê≠£Ëß£„ÇíË°®Á§∫
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    if (btn.textContent.trim() === correct) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, currentMode === 'listening' ? 3500 : 2000); // „É™„Çπ„Éã„É≥„Ç∞„É¢„Éº„Éâ„ÅØÂ∞ë„ÅóÈï∑„ÇÅ„Å´Ë°®Á§∫
        }

        // Èü≥Â£∞Ë™çË≠òÈñãÂßã
        let isRecording = false;
        async function startRecording() {
            // „Åæ„Åö„Éû„Ç§„ÇØ„ÅÆË®±ÂèØ„ÇíÁ¢∫Ë™ç
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                console.log('„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåË®±ÂèØ„Åï„Çå„Åæ„Åó„Åü');
            } catch (error) {
                console.error('„Éû„Ç§„ÇØË®±ÂèØ„Ç®„É©„Éº:', error);
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
                    const isEdge = /Edg/.test(navigator.userAgent);
                    
                    let instructions = '';
                    if (isChrome) {
                        instructions = '„ÄêChrome„Åß„ÅÆË®≠ÂÆöÊñπÊ≥ï„Äë\n' +
                            '1. „Ç¢„Éâ„É¨„Çπ„Éê„Éº„ÅÆÂè≥ÂÅ¥„Å´„ÅÇ„Çãüîí„Åæ„Åü„ÅØüì∑„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '2. „Äå„Éû„Ç§„ÇØ„Äç„ÅÆË®≠ÂÆö„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '3. „ÄåÂÆå‰∫Ü„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø';
                    } else if (isEdge) {
                        instructions = '„ÄêEdge„Åß„ÅÆË®≠ÂÆöÊñπÊ≥ï„Äë\n' +
                            '1. „Ç¢„Éâ„É¨„Çπ„Éê„Éº„ÅÆÂ∑¶ÂÅ¥„Å´„ÅÇ„Çãüîí„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '2. „Äå„Éû„Ç§„ÇØ„Äç„ÅÆÊ®©Èôê„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '3. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàF5„Ç≠„ÉºÔºâ';
                    } else {
                        instructions = '„Äê„Éñ„É©„Ç¶„Ç∂„Åß„ÅÆË®≠ÂÆöÊñπÊ≥ï„Äë\n' +
                            '1. URL„Éê„Éº„ÅÆüîí„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '2. „Çµ„Ç§„Éà„ÅÆË®≠ÂÆö„Åæ„Åü„ÅØÊ®©ÈôêË®≠ÂÆö„ÇíÈñã„Åè\n' +
                            '3. „Äå„Éû„Ç§„ÇØ„Äç„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '4. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø';
                    }
                    
                    alert('„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n\n' + instructions);
                } else if (error.name === 'NotFoundError') {
                    alert('„Éû„Ç§„ÇØ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ\n\n„ÄêÁ¢∫Ë™ç‰∫ãÈ†Ö„Äë\n„Éª„Éû„Ç§„ÇØ„ÅåÊ≠£„Åó„ÅèÊé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Çã„Åã\n„Éª‰ªñ„ÅÆ„Ç¢„Éó„É™„Åå„Éû„Ç§„ÇØ„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Å™„ÅÑ„Åã\n„Éª„Éá„Éê„Ç§„Çπ„ÅÆÈü≥Â£∞Ë®≠ÂÆö„Åß„Éû„Ç§„ÇØ„ÅåÊúâÂäπ„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã');
                } else {
                    alert('„Éû„Ç§„ÇØ„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ\n\n„Ç®„É©„ÉºË©≥Á¥∞: ' + error.message);
                }
                return;
            }
            
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈü≥Â£∞Ë™çË≠ò„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nChrome „Åæ„Åü„ÅØ Edge „Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
            }
            
            const recordBtn = document.getElementById('recordBtn');
            const recognizedDiv = document.getElementById('recognizedText');
            
            if (!isRecording) {
                isRecording = true;
                recordBtn.classList.add('listening');
                recordBtn.textContent = '‚èπÔ∏è Èå≤Èü≥ÂÅúÊ≠¢';
                recognizedDiv.innerHTML = '<p style="color: #666;">ËÅû„ÅçÂèñ„Çä‰∏≠...</p>';
                
                // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº„Çí„ÇØ„É™„Ç¢
                recognition.onresult = null;
                recognition.onerror = null;
                recognition.onend = null;
                
                recognition.onresult = function(event) {
                    console.log('Èü≥Â£∞Ë™çË≠òÁµêÊûú:', event);
                    const transcript = event.results[0][0].transcript;
                    console.log('Ë™çË≠ò„Åï„Çå„Åü„ÉÜ„Ç≠„Çπ„Éà:', transcript);
                    checkSpeaking(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº:', event);
                    isRecording = false;
                    recordBtn.classList.remove('listening');
                    recordBtn.textContent = 'üé§ Èå≤Èü≥ÈñãÂßã';
                    
                    let errorMessage = '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü';
                    if (event.error === 'not-allowed') {
                        errorMessage = `
                            <strong>„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</strong><br><br>
                            „ÄêËß£Ê±∫ÊñπÊ≥ï„Äë<br>
                            1. URL„Éê„Éº„ÅÆüîí„Åæ„Åü„ÅØüì∑„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ<br>
                            2. „Äå„Éû„Ç§„ÇØ„Äç„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥<br>
                            3. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàF5„Ç≠„ÉºÔºâ<br><br>
                            <button class="hint-btn" onclick="location.reload()" style="margin-top: 10px;">
                                „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø
                            </button>
                        `;
                    } else if (event.error === 'no-speech') {
                        errorMessage = 'Èü≥Â£∞„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    } else if (event.error === 'network') {
                        errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ';
                    }
                    recognizedDiv.innerHTML = `<p style="color: #f44336;">${errorMessage}</p>`;
                };
                
                recognition.onend = function() {
                    console.log('Èü≥Â£∞Ë™çË≠òÁµÇ‰∫Ü');
                    isRecording = false;
                    recordBtn.classList.remove('listening');
                    recordBtn.textContent = 'üé§ Èå≤Èü≥ÈñãÂßã';
                };
                
                try {
                    recognition.start();
                    console.log('Èü≥Â£∞Ë™çË≠òÈñãÂßã');
                } catch (error) {
                    console.error('Èü≥Â£∞Ë™çË≠òÈñãÂßã„Ç®„É©„Éº:', error);
                    isRecording = false;
                    recordBtn.classList.remove('listening');
                    recordBtn.textContent = 'üé§ Èå≤Èü≥ÈñãÂßã';
                    alert('Èü≥Â£∞Ë™çË≠ò„ÇíÈñãÂßã„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                }
            } else {
                recognition.stop();
                isRecording = false;
                recordBtn.classList.remove('listening');
                recordBtn.textContent = 'üé§ Èå≤Èü≥ÈñãÂßã';
            }
        }

        // Áô∫Èü≥„ÉÅ„Çß„ÉÉ„ÇØ
        function checkSpeaking(transcript) {
            const recognizedDiv = document.getElementById('recognizedText');
            const similarity = calculateSimilarity(currentQuestion.english.toLowerCase(), transcript.toLowerCase());
            
            isRecording = false;
            const recordBtn = document.getElementById('recordBtn');
            recordBtn.classList.remove('listening');
            recordBtn.textContent = 'üé§ Èå≤Èü≥ÈñãÂßã';
            
            recognizedDiv.innerHTML = `
                <p>Ë™çË≠òÁµêÊûú: <strong>"${transcript}"</strong></p>
                <p>Ê≠£Ëß£: <strong>"${currentQuestion.english}"</strong></p>
            `;
            
            if (similarity > 0.8) {
                score++;
                showFeedback(true, `Á¥†Êô¥„Çâ„Åó„ÅÑÁô∫Èü≥„Åß„ÅôÔºÅüéâ (${Math.round(similarity * 100)}%)`);
            } else if (similarity > 0.6) {
                score += 0.5;
                showFeedback(true, `ËâØ„ÅÑÁô∫Èü≥„Åß„ÅôÔºÅüòä (${Math.round(similarity * 100)}%)`);
            } else {
                showFeedback(false, `„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ üí™ (${Math.round(similarity * 100)}%)`);
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 3000);
        }

        // „Éá„Ç£„ÇØ„ÉÜ„Éº„Ç∑„Éß„É≥„ÉÅ„Çß„ÉÉ„ÇØ
        function checkDictation() {
            const input = document.getElementById('dictationInput').value.trim();
            const correct = currentQuestion.english;
            const similarity = calculateSimilarity(correct.toLowerCase(), input.toLowerCase());
            
            if (similarity > 0.9) {
                score++;
                showFeedback(true, 'ÂÆåÁíß„Åß„ÅôÔºÅüéâ');
                // Ê≠£Ëß£„ÅÆÈü≥Â£∞„ÇíÂÜçÁîü
                if (isSpeechAvailable) {
                    setTimeout(() => {
                        try {
                            const utterance = new SpeechSynthesisUtterance(correct);
                            const voice = selectBestVoiceForBrowser('en-US');
                            if (voice) utterance.voice = voice;
                            utterance.lang = 'en-US';
                            utterance.rate = 0.9;
                            window.speechSynthesis.speak(utterance);
                        } catch (error) {
                            console.error('Ê≠£Ëß£Èü≥Â£∞„Ç®„É©„Éº:', error);
                        }
                    }, 500);
                }
            } else if (similarity > 0.7) {
                showFeedback(true, `„Åª„ÅºÊ≠£Ëß£ÔºÅüòä Ê≠£Ëß£: "${correct}"`);
            } else {
                showFeedback(false, `‰∏çÊ≠£Ëß£... Ê≠£Ëß£„ÅØ„Äå${correct}„Äç„Åß„Åó„Åü`);
            }
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 2500);
        }

        // „Éí„É≥„ÉàË°®Á§∫
        function showHint() {
            const hintDiv = document.getElementById('hintText');
            const words = currentQuestion.english.split(' ');
            const hint = words.map(word => word[0] + '_'.repeat(word.length - 1)).join(' ');
            hintDiv.innerHTML = `<p class="hint-text">„Éí„É≥„Éà: ${hint}</p>`;
        }

        // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫
        function showFeedback(isCorrect, message) {
            const content = document.getElementById('quizContent');
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.innerHTML = message; // textContent„Åã„ÇâinnerHTML„Å´Â§âÊõ¥„Åó„Å¶HTML„Çø„Ç∞„ÇíÊúâÂäπÂåñ
            content.appendChild(feedback);
            
            // Ê≠£Ëß£Èü≥/‰∏çÊ≠£Ëß£Èü≥„ÇíÂÜçÁîü
            try {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(isCorrect ? 'Good job!' : 'Try again');
                const voice = selectBestVoiceForBrowser('en-US');
                if (voice) utterance.voice = voice;
                utterance.lang = 'en-US';
                utterance.rate = 1.2;
                utterance.volume = 0.5;
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈü≥Â£∞„Ç®„É©„Éº:', error);
            }
        }

        // È°û‰ººÂ∫¶Ë®àÁÆó
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const distance = levenshteinDistance(longer, shorter);
            return (longer.length - distance) / longer.length;
        }

        // „É¨„Éº„Éô„É≥„Ç∑„É•„Çø„Ç§„É≥Ë∑ùÈõ¢
        function levenshteinDistance(str1, str2) {
            const m = str1.length;
            const n = str2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
            
            for (let i = 0; i <= m; i++) dp[i][0] = i;
            for (let j = 0; j <= n; j++) dp[0][j] = j;
            
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (str1[i - 1] === str2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1];
                    } else {
                        dp[i][j] = 1 + Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]);
                    }
                }
            }
            
            return dp[m][n];
        }

        // ÁµêÊûúË°®Á§∫
        function showResults() {
            const percentage = Math.round((score / questions.length) * 100);
            let message = '';
            let emoji = '';
            
            if (percentage >= 90) {
                message = 'Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ„Éû„Çπ„Çø„Éº„É¨„Éô„É´„Åß„ÅôÔºÅ';
                emoji = 'üèÜ';
            } else if (percentage >= 70) {
                message = '„Å®„Å¶„ÇÇËâØ„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ';
                emoji = 'üåü';
            } else if (percentage >= 50) {
                message = '„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ';
                emoji = 'üëç';
            } else {
                message = '„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅ';
                emoji = 'üí™';
            }
            
            const categoryName = {
                all: 'ÂÖ®„Ç´„ÉÜ„Ç¥„É™„Éº',
                greeting: 'Êå®Êã∂',
                airport: 'Á©∫Ê∏Ø',
                hotel: '„Éõ„ÉÜ„É´',
                restaurant: '„É¨„Çπ„Éà„É©„É≥',
                shopping: 'Ë≤∑„ÅÑÁâ©',
                transportation: '‰∫§ÈÄö',
                emergency: 'Á∑äÊÄ•ÊôÇ',
                communication: '‰ºöË©±'
            };
            
            const container = document.getElementById('quizContainer');
            container.innerHTML = `
                <div class="results-container">
                    <h2 class="results-title">„ÇØ„Ç§„Ç∫ÁµÇ‰∫ÜÔºÅ ${emoji}</h2>
                    <div class="results-score">${score} / ${questions.length}</div>
                    <div class="results-message">${message}</div>
                    <div class="results-details">
                        <p>Ê≠£Á≠îÁéá: ${percentage}%</p>
                        <p>„É¢„Éº„Éâ: ${getCurrentModeName()}</p>
                        <p>„Ç´„ÉÜ„Ç¥„É™„Éº: ${categoryName[currentCategory]}</p>
                    </div>
                    <button class="restart-btn" onclick="location.reload()">
                        „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶„Åô„Çã üîÑ
                    </button>
                </div>
            `;
            
            // ÁµêÊûúÈü≥Â£∞
            try {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(`Great job! You scored ${score} out of ${questions.length}.`);
                const voice = selectBestVoiceForBrowser('en-US');
                if (voice) utterance.voice = voice;
                utterance.lang = 'en-US';
                utterance.rate = 1.0;
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('ÁµêÊûúÈü≥Â£∞„Ç®„É©„Éº:', error);
            }
        }

        // ÁèæÂú®„ÅÆ„É¢„Éº„ÉâÂêçÂèñÂæó
        function getCurrentModeName() {
            const names = {
                translate: 'ÁøªË®≥„ÇØ„Ç§„Ç∫',
                listening: '„É™„Çπ„Éã„É≥„Ç∞„ÇØ„Ç§„Ç∫',
                speaking: 'Áô∫Èü≥„ÇØ„Ç§„Ç∫',
                dictation: '„Éá„Ç£„ÇØ„ÉÜ„Éº„Ç∑„Éß„É≥'
            };
            return names[currentMode];
        }

        // Èü≥Â£∞„ÉÜ„Çπ„ÉàÔºàÊúÄÈÅ©ÂåñÁâàÔºâ
        function testVoice() {
            if (!window.speechSynthesis) {
                alert('Èü≥Â£∞Ê©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                return;
            }
            
            try {
                window.speechSynthesis.cancel();
                
                const browser = detectBrowser();
                const testPhrases = {
                    Safari: "Hello! This is Safari's voice test. How does this sound?",
                    Chrome: "Hello! This is Chrome's voice test. Can you hear me clearly?",
                    Other: "Hello! Testing voice quality. How natural does this sound?"
                };
                
                const utterance = new SpeechSynthesisUtterance(testPhrases[browser.browser]);
                const voice = selectBestVoiceForBrowser('en-US');
                
                if (voice) {
                    utterance.voice = voice;
                }
                
                // „Éñ„É©„Ç¶„Ç∂Âà•Ë®≠ÂÆö
                if (browser.isSafari && browser.isIOS) {
                    utterance.rate = 0.95;
                    utterance.pitch = 1.0;
                } else if (browser.isChrome && browser.isAndroid) {
                    utterance.rate = 0.85;
                    utterance.pitch = 1.02;
                } else {
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                }
                
                utterance.lang = 'en-US';
                utterance.volume = 1.0;
                
                utterance.onend = () => {
                    const quality = voice?.name.includes('Enhanced') ? 'ÊúÄÈ´òÂìÅË≥™' : 
                                   voice?.name.includes('Google') ? 'È´òÂìÅË≥™' : 'Ê®ôÊ∫ñÂìÅË≥™';
                    
                    alert(`
Èü≥Â£∞„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÔºÅ ‚úÖ

„Éñ„É©„Ç¶„Ç∂: ${browser.browser}
‰ΩøÁî®Èü≥Â£∞: ${voice ? voice.name : '„Éá„Éï„Ç©„É´„Éà'}
Èü≥Â£∞ÂìÅË≥™: ${quality}

„Çà„ÇäËá™ÁÑ∂„Å™Èü≥Â£∞„Å´„Åô„Çã„Å´„ÅØ„ÄåÈü≥Â£∞ÂìÅË≥™Ë®∫Êñ≠„Äç„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ
                    `);
                };
                
                window.speechSynthesis.speak(utterance);
                
            } catch (error) {
                alert('Èü≥Â£∞„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ' + error.message);
            }
        }

        // „Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà
        async function testMicrophone() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                // „Çπ„Éà„É™„Éº„É†„ÇíÂÅúÊ≠¢
                stream.getTracks().forEach(track => track.stop());
                
                alert('„Éû„Ç§„ÇØ„ÉÜ„Çπ„ÉàÊàêÂäüÔºÅ‚úÖ\n\n„Éû„Ç§„ÇØ„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\nÁô∫Èü≥„ÇØ„Ç§„Ç∫„ÅßÈü≥Â£∞Ë™çË≠ò„Åå‰ΩøÁî®„Åß„Åç„Åæ„Åô„ÄÇ');
            } catch (error) {
                console.error('„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
                
                const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
                const isEdge = /Edg/.test(navigator.userAgent);
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    let message = '„Éû„Ç§„ÇØ„ÅÆ‰ΩøÁî®„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ\n\n';
                    
                    if (isChrome) {
                        message += '„ÄêChrome„Åß„Éû„Ç§„ÇØ„ÇíË®±ÂèØ„Åô„ÇãÊñπÊ≥ï„Äë\n\n' +
                            'ÊñπÊ≥ï1ÔºàÊé®Â•®Ôºâ:\n' +
                            '1. „Åì„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈñâ„Åò„Çã\n' +
                            '2. „Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂè≥ÂÅ¥„ÅÆüì∑„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '3. „Äå„Éû„Ç§„ÇØ„Äç„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '4. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàF5„Ç≠„ÉºÔºâ\n\n' +
                            'ÊñπÊ≥ï2:\n' +
                            '1. ChromeË®≠ÂÆö ‚Üí „Éó„É©„Ç§„Éê„Ç∑„Éº„Å®„Çª„Ç≠„É•„É™„ÉÜ„Ç£\n' +
                            '2. „Çµ„Ç§„Éà„ÅÆË®≠ÂÆö ‚Üí „Éû„Ç§„ÇØ\n' +
                            '3. „Åì„ÅÆ„Çµ„Ç§„Éà„Çí„ÄåË®±ÂèØ„Äç„Å´ËøΩÂä†';
                    } else if (isEdge) {
                        message += '„ÄêEdge„Åß„Éû„Ç§„ÇØ„ÇíË®±ÂèØ„Åô„ÇãÊñπÊ≥ï„Äë\n\n' +
                            '1. „Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂ∑¶ÂÅ¥„ÅÆüîí„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '2. „Äå„Åì„ÅÆ„Çµ„Ç§„Éà„ÅÆ„Ç¢„ÇØ„Çª„ÇπË®±ÂèØ„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ\n' +
                            '3. „Äå„Éû„Ç§„ÇØ„Äç„Çí„ÄåË®±ÂèØ„Äç„Å´Â§âÊõ¥\n' +
                            '4. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„ÅøÔºàF5„Ç≠„ÉºÔºâ';
                    } else {
                        message += '„Äê„Éû„Ç§„ÇØ„ÇíË®±ÂèØ„Åô„ÇãÊñπÊ≥ï„Äë\n\n' +
                            '1. „Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„ÇíÈñã„Åè\n' +
                            '2. „Éó„É©„Ç§„Éê„Ç∑„Éº/„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö\n' +
                            '3. „Çµ„Ç§„Éà„ÅÆÊ®©Èôê ‚Üí „Éû„Ç§„ÇØ\n' +
                            '4. „Åì„ÅÆ„Çµ„Ç§„Éà„ÇíË®±ÂèØ„É™„Çπ„Éà„Å´ËøΩÂä†\n' +
                            '5. „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø';
                    }
                    
                    alert(message);
                } else if (error.name === 'NotFoundError') {
                    alert('„Éû„Ç§„ÇØ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ‚ùå\n\n„ÄêÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Äë\n„Éª„Éû„Ç§„ÇØ„ÅåÊ≠£„Åó„ÅèÊé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Çã„Åã\n„Éª„Éá„Éê„Ç§„Çπ„Éû„Éç„Éº„Ç∏„É£„Éº„Åß„Éû„Ç§„ÇØ„ÅåË™çË≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Åã\n„Éª‰ªñ„ÅÆ„Ç¢„Éó„É™ÔºàZoomÁ≠âÔºâ„Åå„Éû„Ç§„ÇØ„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Å™„ÅÑ„Åã\n„ÉªWindows„ÅÆ„ÄåË®≠ÂÆö„Äç‚Üí„Äå„Éó„É©„Ç§„Éê„Ç∑„Éº„Äç‚Üí„Äå„Éû„Ç§„ÇØ„Äç„Åß\n  „Éñ„É©„Ç¶„Ç∂„ÅÆ„Éû„Ç§„ÇØ„Ç¢„ÇØ„Çª„Çπ„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Çã„Åã');
                } else {
                    alert('„Éû„Ç§„ÇØ„ÉÜ„Çπ„Éà„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ\n\n„Ç®„É©„Éº: ' + error.message + '\n\nÂà•„ÅÆ„Éñ„É©„Ç¶„Ç∂ÔºàChrome/EdgeÔºâ„Åß„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                }
            }
        }

        // „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„Çπ„ÅÆ„Çµ„Éù„Éº„Éà
        document.addEventListener('touchstart', function() {}, {passive: true});
    </script>
</body>
</html>
